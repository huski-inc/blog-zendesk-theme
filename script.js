var _INFO_SVG = `<svg width="19" height="19" viewBox="0 0 19 19" fill="none" >
<circle cx="9.53516" cy="9.40479" r="9" fill="#8BA3F2"/>
<path d="M10.9014 8.84443C10.9014 9.29243 10.7574 10.0658 10.4694 11.1644C10.1814 12.2524 10.0374 12.9671 10.0374 13.3084C10.0374 13.6391 10.0854 13.8044 10.1814 13.8044C10.2454 13.8044 10.4907 13.7031 10.9174 13.5004L11.1094 13.4044L11.3814 13.9644C11.2854 14.0498 11.1574 14.1564 10.9974 14.2844C10.8374 14.4124 10.5387 14.5884 10.1014 14.8124C9.66404 15.0258 9.25871 15.1324 8.88538 15.1324C8.51204 15.1324 8.21871 15.0204 8.00538 14.7964C7.79204 14.5618 7.68538 14.2524 7.68538 13.8684C7.68538 13.4738 7.81871 12.7804 8.08538 11.7884C8.35204 10.7858 8.48538 10.1351 8.48538 9.83643C8.48538 9.38843 8.34671 8.9671 8.06938 8.57243L7.92538 8.38043L7.94138 8.17243C8.50671 8.01243 9.42404 7.93243 10.6934 7.93243C10.832 8.09243 10.9014 8.39643 10.9014 8.84443ZM9.07738 6.18843C8.86404 5.9751 8.75738 5.69243 8.75738 5.34043C8.75738 4.98843 8.90138 4.6791 9.18938 4.41243C9.48804 4.14576 9.82938 4.01243 10.2134 4.01243C10.5974 4.01243 10.896 4.1191 11.1094 4.33243C11.3227 4.54576 11.4294 4.82843 11.4294 5.18043C11.4294 5.52176 11.2747 5.82576 10.9654 6.09243C10.6667 6.3591 10.3307 6.49243 9.95738 6.49243C9.58404 6.49243 9.29071 6.3911 9.07738 6.18843Z" fill="white"/>
</svg>
`
var _WARNING_SVG = `<svg width="19" height="19" viewBox="0 0 19 19" fill="none" >
<circle cx="9.53516" cy="9.80664" r="9" fill="#FFBF19"/>
<path d="M10.6808 4.11205V8.40205C10.6808 8.86205 10.6533 9.31955 10.5983 9.77455C10.5433 10.2246 10.4708 10.6846 10.3808 11.1546H8.80575C8.71575 10.6846 8.64325 10.2246 8.58825 9.77455C8.53325 9.31955 8.50575 8.86205 8.50575 8.40205V4.11205H10.6808ZM8.25075 13.8621C8.25075 13.6821 8.28325 13.5146 8.34825 13.3596C8.41825 13.2046 8.51075 13.0696 8.62575 12.9546C8.74575 12.8396 8.88575 12.7496 9.04575 12.6846C9.20575 12.6146 9.38075 12.5796 9.57075 12.5796C9.75575 12.5796 9.92825 12.6146 10.0883 12.6846C10.2483 12.7496 10.3883 12.8396 10.5083 12.9546C10.6283 13.0696 10.7208 13.2046 10.7858 13.3596C10.8558 13.5146 10.8908 13.6821 10.8908 13.8621C10.8908 14.0421 10.8558 14.2121 10.7858 14.3721C10.7208 14.5271 10.6283 14.6621 10.5083 14.7771C10.3883 14.8921 10.2483 14.9821 10.0883 15.0471C9.92825 15.1121 9.75575 15.1446 9.57075 15.1446C9.38075 15.1446 9.20575 15.1121 9.04575 15.0471C8.88575 14.9821 8.74575 14.8921 8.62575 14.7771C8.51075 14.6621 8.41825 14.5271 8.34825 14.3721C8.28325 14.2121 8.25075 14.0421 8.25075 13.8621Z" fill="white"/>
</svg>
`
var _SUCCESS_SVG = `<svg width="19" height="19" viewBox="0 0 19 19" fill="none">
<circle cx="9.32227" cy="9.2085" r="9" fill="#24CE85"/>
<path d="M5.14398 8.54973L8.26214 11.7801L13.5011 6.63721" stroke="white" stroke-width="1.6" stroke-linecap="round"/>
</svg>
`
var _ERROR_SVG = `<svg width="19" height="19" viewBox="0 0 19 19" fill="none">
<circle cx="9.53516" cy="9.00293" r="9" fill="#FD696D"/>
<path d="M6.68921 6.15723L12.3808 11.8491" stroke="white" stroke-width="1.6" stroke-linecap="round"/>
<path d="M12.3804 6.15771L6.68851 11.8493" stroke="white" stroke-width="1.6" stroke-linecap="round"/>
</svg>
`
var _UPGRADE_SVG = `<svg width="28" height="28" viewBox="0 0 28 28" fill="none">
<circle cx="14" cy="14" r="14" fill="#24CE85"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.99484 13.8289C8.93478 13.1793 8.50267 6.89398 13.9324 4.02283C13.9862 3.99439 14.0525 3.9923 14.1077 4.0178C18.6542 6.11642 19.3369 11.3897 19.1056 13.8311C19.1023 13.8663 19.1078 13.8995 19.1218 13.932C19.3092 14.3663 20.6449 17.6256 19.6122 20.0221C19.5534 20.1586 19.3695 20.173 19.2787 20.0554C18.9265 19.5989 18.1302 18.6263 17.1958 17.8714C17.1515 17.8355 17.0953 17.8208 17.039 17.8294C16.5527 17.9042 14.0729 18.2378 10.8237 17.8337C10.7681 17.8268 10.711 17.8436 10.6683 17.8799C9.75539 18.6559 9.42265 19.0296 8.58573 20.0549C8.4903 20.1718 8.31136 20.1445 8.26888 19.9997C8.02847 19.1802 7.56648 16.8373 8.97408 13.9371C8.99089 13.9025 8.99838 13.8672 8.99484 13.8289ZM16 11.2143C16 12.3189 15.1046 13.2143 14 13.2143C12.8954 13.2143 12 12.3189 12 11.2143C12 10.1098 12.8954 9.21434 14 9.21434C15.1046 9.21434 16 10.1098 16 11.2143ZM13.9146 18.6802C13.3571 18.7249 12.2245 19.0091 12.154 19.7879C12.0658 20.7614 13.0461 23.9839 13.9146 23.9839C14.5311 23.9839 15.8519 21.3656 15.8519 19.7879C15.793 19.4187 15.3231 18.6802 13.9146 18.6802Z" fill="white"/>
</svg>`

var _INFO_CURRENT_SVG = `<svg width="19" height="19" viewBox="0 0 19 19" fill="none" >
<circle cx="9.53516" cy="9.40479" r="9" fill="currentColor"/>
<path d="M10.9014 8.84443C10.9014 9.29243 10.7574 10.0658 10.4694 11.1644C10.1814 12.2524 10.0374 12.9671 10.0374 13.3084C10.0374 13.6391 10.0854 13.8044 10.1814 13.8044C10.2454 13.8044 10.4907 13.7031 10.9174 13.5004L11.1094 13.4044L11.3814 13.9644C11.2854 14.0498 11.1574 14.1564 10.9974 14.2844C10.8374 14.4124 10.5387 14.5884 10.1014 14.8124C9.66404 15.0258 9.25871 15.1324 8.88538 15.1324C8.51204 15.1324 8.21871 15.0204 8.00538 14.7964C7.79204 14.5618 7.68538 14.2524 7.68538 13.8684C7.68538 13.4738 7.81871 12.7804 8.08538 11.7884C8.35204 10.7858 8.48538 10.1351 8.48538 9.83643C8.48538 9.38843 8.34671 8.9671 8.06938 8.57243L7.92538 8.38043L7.94138 8.17243C8.50671 8.01243 9.42404 7.93243 10.6934 7.93243C10.832 8.09243 10.9014 8.39643 10.9014 8.84443ZM9.07738 6.18843C8.86404 5.9751 8.75738 5.69243 8.75738 5.34043C8.75738 4.98843 8.90138 4.6791 9.18938 4.41243C9.48804 4.14576 9.82938 4.01243 10.2134 4.01243C10.5974 4.01243 10.896 4.1191 11.1094 4.33243C11.3227 4.54576 11.4294 4.82843 11.4294 5.18043C11.4294 5.52176 11.2747 5.82576 10.9654 6.09243C10.6667 6.3591 10.3307 6.49243 9.95738 6.49243C9.58404 6.49243 9.29071 6.3911 9.07738 6.18843Z" fill="white"/>
</svg>
`
var svgIcons = {
  info_current: _INFO_CURRENT_SVG,
  info: _INFO_SVG,
  warning: _WARNING_SVG,
  success: _SUCCESS_SVG,
  error: _ERROR_SVG,
  upgrade: _UPGRADE_SVG,
}


function appendHTML(
  type,
  title,
  message,
  btnTemplate,
  dangerouslyUseHTMLString,
) {
  // 图标
  const iconHTML = type ? svgIcons[type] : ''

  const noTitle = title ? '' : 'no-title'
  if (!dangerouslyUseHTMLString) {
    title = title.replace(/<[^<>]+>/g, '')
    message = message.replace(/<[^<>]+>/g, '')
  }

  // 窗体HTML
  const template = `
    <div class="huski-alert alert-wrapper">
      <div class="alert-frame">
        <div class="alert-header">
          <span class="alert-close"></span>
        </div>
        <div class="alert-body">
          <div class="alert-body__main">
            ${iconHTML}
            <div ${iconHTML ? '' : 'style="margin-left:0"'}>
              <div class="alert-title">${title}</div>
              <div class="alert-message ${noTitle}">${message}</div>
            </div>
          </div>
          <div class="alert-body__button">
            ${btnTemplate}
          </div>
        </div>
      </div>
    </div>
    `
  const body = document.querySelector('body')
  body?.insertAdjacentHTML('beforeend', template)
}

/**
 * 根据国际化转化默认文字
 * @param text
 * @returns {*}
 */
function transferLang(text) {
  switch (text?.toLowerCase()) {
    case 'ok':
      return 'OK' //bus.$t('word.ok')
    case 'cancel':
      return 'Cancel' //bus.$t('word.cancel')
    default:
      return text
  }
}

/**
 * Confirm 弹窗
 * @param {*} type success\error\warning\info\question
 * @param {*} title 标题
 * @param {*} message 消息
 * @param {*} checkText 复选框后文字
 * @param {*} isChecked 是否选中复选框
 * @param {*} okText 确定按钮文字
 * @param {*} cancelText 取消按钮文字
 * @param {*} dangerouslyUseHTMLString 是否允许HTML
 * @returns
 */
function huskiConfirm({
  type = 'info', // success\error\warning\info\question
  title = '',
  message = '',
  checkText = '',
  isChecked = false,
  okText = 'OK',
  cancelText = 'Cancel',
  thirdButtonText = '',
  dangerouslyUseHTMLString = false,
}) {
  const huskiAlert = document.querySelectorAll('.huski-alert')

  if (huskiAlert.length > 0) {
    return Promise.reject('Up to one Confirm exists at a time.')
  }
  return new Promise((resolve, reject) => {
    let checkBoxTemplate = '',
      checked = ''

    if (isChecked) {
      checked = 'checked'
    }
    if (checkText !== '') {
      checkBoxTemplate = `<div class="confirm-check"><input type="checkbox" ${checked} id="confirm_check"/><label for="confirm_check">&nbsp;${checkText}</label></div>`
    }

    // 第三个按钮
    let thirdButtonHtml = ''
    if (thirdButtonText) {
      thirdButtonHtml = `<button type="button" plain class="alert-button third-button">${thirdButtonText}</button>`
    }
    // 按钮HTML
    let btnTemplate = `
    <div class="confirm-buttons">
     ${checkBoxTemplate}
      <div>
      <button type="button" plain class="alert-button cancel-button">${transferLang(
        cancelText,
      )}</button>&nbsp;&nbsp;${thirdButtonHtml}&nbsp;&nbsp;<button type="button" class="alert-button confirm-button">${transferLang(
      okText,
    )}</button></div>
    </div>
    `
    appendHTML(type, title, message, btnTemplate, dangerouslyUseHTMLString)

    const alertWrapper = document.querySelector('.alert-wrapper')
    const alertFrame = document.querySelector('.alert-frame')
    const alertClose = document.querySelector(`.alert-close`)

    // 处理confirm

    const confirmButton = document.querySelector('.confirm-button')
    const cancelButton = document.querySelector('.cancel-button')
    const thirdButtonDom = document.querySelector('.third-button')

    confirmButton?.addEventListener('click', () => {
      let checked = ''
      const ele = document.querySelector('#confirm_check')
      if (ele) {
        console.log('confirm_check', ele)
        // @ts-ignore
        checked = ele.checked
      }
      alertWrapper?.remove()
      resolve({ type: 'ok', checked: !!checked })
    })
    cancelButton?.addEventListener('click', () => {
      if (cancelText === 'Refresh' || cancelText === '刷新') {
        window.location.reload()
        // if (typeof window === 'undefined') {
        //   // @ts-ignore
        //   window.location.reload()
        // } else {
        //   bus.$router?.go(0)
        // }
      } else {
        alertWrapper?.remove()
        resolve({ type: 'cancel' })
      }
    })
    thirdButtonDom?.addEventListener('click', () => {
      alertWrapper?.remove()
      resolve({ type: 'cancel' })
    })

    const handleClose = () => {
      alertWrapper?.remove()
      resolve({ type: 'third' })
    }
    // 关闭按钮事件
    alertClose?.addEventListener('click', handleClose)
    // 窗体外的事件
    alertWrapper?.addEventListener('click', handleClose)
    // 点击窗体的事件 阻止冒泡
    alertFrame?.addEventListener('click', (e) => {
      e.stopPropagation()
    })
  })
}
/**
 * Alert 弹窗
 * @param {*}  type success\error\warning\info\question
 * @param {*} title 标题
 * @param {*}  message 消息
 * @param {*}  okText 确定按钮文字
 * @param {*}  cancelText 取消按钮文字
 * @param {*}  dangerouslyUseHTMLString 是否允许HTML
 * @returns
 */
function huskiAlert({
  type = 'info', // success\error\warning\info\question
  title = '',
  message = '',
  okText = 'OK',
  dangerouslyUseHTMLString = false,
}) {
  const huskiAlert = document.querySelectorAll('.huski-alert')
  if (huskiAlert.length > 0) {
    return Promise.reject('Up to one Alert exists at a time.')
  }
  return new Promise((resolve) => {
    // 按钮HTML
    let btnTemplate = `
    <button type="button" class="alert-button">${transferLang(okText)}</button>
    `
    appendHTML(type, title, message, btnTemplate, dangerouslyUseHTMLString)

    const alertWrapper = document.querySelector('.alert-wrapper')
    const alertFrame = document.querySelector('.alert-frame')
    const alertClose = document.querySelector(`.alert-close`)
    const alertButton = document.querySelector('.alert-button')

    const handleOK = () => {
      alertWrapper?.remove()
      resolve({ type: 'ok' })
    }
    const handleClose = () => {
      alertWrapper?.remove()
      resolve({ type: 'close' })
    }

    alertButton?.addEventListener('click', handleOK)
    // 关闭按钮事件
    alertClose?.addEventListener('click', handleClose)
    // 窗体外的事件
    alertWrapper?.addEventListener('click', handleClose)
    // 点击窗体的事件 阻止冒泡
    alertFrame?.addEventListener('click', (e) => {
      e.stopPropagation()
    })
  })
}

function huskiNotify({ type, title, message, timer = 5000 }) {
  return new Promise((resolve) => {
    if (document.querySelector('.toast-container')) {
      document.querySelector('.toast-container')?.remove()
    }
    const body = document.querySelector('body')
    // 图标
    const iconHTML = type ? svgIcons[type] : ''
    const template = `
    <div class="toast-container">
      <div>
        <div class="toast-frame">
           <div class="toast-close"></div>
           ${iconHTML}
           <div class="toast-body">
              <div class="toast-title">${title}</div>
              <div class="toast-message">${message}</div>
           </div>
        </div>

      </div>
    </div>
    `
    // <div class="toast-timer" style="animation: timer ${timer}ms linear;"/>

    body?.insertAdjacentHTML('afterend', template)

    const toastContainer = document.querySelector('.toast-container')

    setTimeout(() => {
      toastContainer?.remove()
      resolve({ type: 'ok' })
    }, timer)

    const toastClose = document.querySelector('.toast-close')

    toastClose?.addEventListener('click', () => {
      toastContainer?.remove()
      resolve({ type: 'ok' })
    })
  })
}

//--------------------------- 分割线 ------------------------//

const getFirstImage = function(str){
  let data = '';
  str.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/, function (match, capture) {
              data =  capture;
        });
  return data
}


const networks = {
  baidu: 'http://cang.baidu.com/do/add?iu=@u&it=@t',
  buffer: 'https://bufferapp.com/add?text=@t&url=@u',
  email: 'mailto:?subject=@t&body=@u%0D%0A@d',
  evernote: 'https://www.evernote.com/clip.action?url=@u&title=@t',
  facebook: 'https://www.facebook.com/sharer/sharer.php?u=@u&title=@t&description=@d&quote=@q&hashtag=@h',
  flipboard: 'https://share.flipboard.com/bookmarklet/popout?v=2&url=@u&title=@t',
  hackernews: 'https://news.ycombinator.com/submitlink?u=@u&t=@t',
  instapaper: 'http://www.instapaper.com/edit?url=@u&title=@t&description=@d',
  line: 'http://line.me/R/msg/text/?@t%0D%0A@u%0D%0A@d',
  linkedin: 'https://www.linkedin.com/shareArticle?url=@u',
  messenger: 'fb-messenger://share/?link=@u',
  odnoklassniki: 'https://connect.ok.ru/dk?st.cmd=WidgetSharePreview&st.shareUrl=@u&st.comments=@t',
  pinterest: 'https://pinterest.com/pin/create/button/?url=@u&media=@m&description=@t',
  pocket: 'https://getpocket.com/save?url=@u&title=@t',
  quora: 'https://www.quora.com/share?url=@u&title=@t',
  reddit: 'https://www.reddit.com/submit?url=@u&title=@t',
  skype: 'https://web.skype.com/share?url=@t%0D%0A@u%0D%0A@d',
  telegram: 'https://t.me/share/url?url=@u&text=@t%0D%0A@d',
  tumblr: 'https://www.tumblr.com/share/link?url=@u&name=@t&description=@d',
  twitter: 'https://twitter.com/intent/tweet?text=@t&url=@u&hashtags=@h@tu',
  weibo: 'http://service.weibo.com/share/share.php?url=@u&title=@t&pic=@m',
  whatsapp: 'https://api.whatsapp.com/send?text=@t%0D%0A@u%0D%0A@d',
}

function encodedHashtags(options) {
  if (options.key === 'facebook' && options.hashtags?.length) {
    return '%23' + options.hashtags.split(',')[0]
  }

  return options.hashtags || ''
}

function shareLink(options) {
  let link = networks[options.key]

  /**
   * Twitter sharing shouldn't include empty parameter
   * Source: https://github.com/nicolasbeauvais/vue-social-sharing/issues/143
   */
  if (options.key === 'twitter') {
    if (!options.hashtags?.length) link = link.replace('&hashtags=@h', '')
    if (!options.twitterUser.length) link = link.replace('@tu', '')
  }

  return link
    .replace(/@tu/g, '&via=' + encodeURIComponent(options.twitterUser))
    .replace(/@u/g, encodeURIComponent('{{settings.domain}}' + options.url))
    .replace(/@t/g, encodeURIComponent(options.title || ''))
    .replace(/@d/g, encodeURIComponent(options.description || ''))
    .replace(/@q/g, encodeURIComponent(options.quote || ''))
    .replace(/@h/g, encodedHashtags(options))
    .replace(/@m/g, encodeURIComponent(options.media || ''))
}
function onShare(options) {
  const link = shareLink(options)
  window.open(link, '_blank')
}


function copyText(text, callback) {
  const input = document.createElement('input')
  input.setAttribute('readonly', 'readonly')
  input.setAttribute('value', text)
  document.body.appendChild(input)
  input.setSelectionRange(0, 9999)
  input.select()
  if (document.execCommand('copy')) {
    document.execCommand('copy')
    if (callback) {
      callback()
    }
  }
  document.body.removeChild(input)
}
function onCopy(url) {
  copyText('{{settings.domain}}' + url)
  huskiNotify({type: 'success',title: 'Copy Link',message: 'Link copied to your clipboard!',timer: 3000})
}


function ajaxPost(url, data, callback) {
  var xhr = new XMLHttpRequest();
  xhr.open('POST', url, true);
  xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
  xhr.send(data);

  xhr.onreadystatechange = function () {
    if (xhr.readyState == 4 && xhr.status == 200) {
      callback(xhr.responseText);
    }
  }
}

function isEmail(value) {
  let reg = /^\S+@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,5}$/
  if (!reg.test(value)) {
    return false
  } else {
    return true
  }
}
function onSubscribe(){
  const emailInput=document.querySelector('#subscribeEmail')
  if(emailInput){
   const email = emailInput.value
   if(email){
    if(!isEmail(email)){
      huskiAlert({ type: 'info', title: 'Tips', message: 'The email must be a valid email address.'})
      return false
    }
      const url = location.href||'';
      ajaxPost('https://api.huski.ai/api/v2/blog/subscription', 'email='+email+'&url='+url, function (data) {
        // 后台返回的数据就是 字符串类型。要转成json，必须自己手动转换。
        var res = JSON.parse(data);
        if(res.code===0){
          emailInput.value=''
          huskiAlert({ type: 'success', title: 'Successfully', message: 'Subscribe successfully!'})
        } else {
          huskiAlert({ type: 'warning', title: 'Warning', message: res.msg.text})
        }
      });
   }
  }
}

document.addEventListener('DOMContentLoaded', function() {
  /**
   * Header tiipy
   */
  const popperOptions = { modifiers: [
    {
      name: 'computeStyles',
      enabled: true,
      fn({ state }) {
        console.log('state', state)
        state.styles.arrow = {
          position: 'fixed',
          left: state.rects.reference.x + state.rects.reference.width / 2 - 20 + 'px',
          top: '4.375rem',
        }
        state.styles.popper = {
          ...state.styles.popper,
          position: 'fixed',
          left: `${(window.innerWidth - state.rects.popper.width) / 2}px`,
          top: '4.375rem',
        }
        return state
      },
    },
  ],}
  const navProductTemplate = document.getElementById('nav-product-template');
  if(navProductTemplate){
    tippy('#nav-product', {
      content: navProductTemplate.innerHTML,
      allowHTML: true,
      interactive: true,
      trigger: 'mouseenter click',
      theme: 'light-nav',
      placement:'bottom',
      maxWidth:'100%',
      popperOptions: popperOptions
    });
  }
  const navInsightsTemplate = document.getElementById('nav-insights-template');
  if(navProductTemplate){
    tippy('#nav-insights', {
      content: navInsightsTemplate.innerHTML,
      allowHTML: true,
      interactive: true,
      trigger: 'mouseenter click',
      theme: 'light-nav',
      placement:'bottom',
      maxWidth:'100%',
      popperOptions: popperOptions
    });
  }
  const navAboutTemplate = document.getElementById('nav-about-template');
  if(navProductTemplate){
    tippy('#nav-about', {
      content: navAboutTemplate.innerHTML,
      allowHTML: true,
      interactive: true,
      trigger: 'mouseenter click',
      theme: 'light-nav',
      placement:'bottom',
      maxWidth:'100%',
      popperOptions: popperOptions
    });
  }



  // 将文章body第一章图片显示出来
  const articleBody=document.querySelectorAll('.article-cover-init')
  if(articleBody){
    for(let i=0;i<articleBody.length;i++){
      const body=articleBody[i]
      const bodyHtml= body.innerHTML
      if(bodyHtml){
        const imageUrl= getFirstImage(bodyHtml)
        body.innerHTML=imageUrl?`<img src="${imageUrl}"/>`:''//`<div class="no-image">NO IMAGE</div>`
        body.setAttribute("class", "article-cover");
        if(!imageUrl) {
          const parent=body.parentElement||body.parentNode
          const className=parent.getAttribute('class')
          if(className.indexOf('article-image-box')>-1){
            parent.nextElementSibling?.setAttribute("class", "col-lg-12 col-sm-12 section-article-list-item-right")
            parent.remove()
            // parent.setAttribute("class", className+" no-image-box")
          }
        }
      }
    }
  }

  // 初始化文章中的日期
  const articleBodyForDate=document.querySelectorAll('.article-date-init')
  if(articleBodyForDate){
    for(let i=0;i<articleBodyForDate.length;i++){
      const body=articleBodyForDate[i]
      const bodyHtml= body.innerHTML
      if(bodyHtml){
        const _matches= bodyHtml.match(/##(\d.*|\-.*)##/)
        if(_matches){
          const _date = _matches[1]
          body.innerHTML=_date?_date:''
        }
      }
    }
  }

  const articleDescription=document.querySelectorAll('.article-description')
  if(articleDescription){
    for(let i=0;i<articleDescription.length;i++){
      const descElement=articleDescription[i]
      const desc= descElement.innerText
      if(desc&&descElement){
        descElement.innerHTML=desc.trim()
      }
    }
  }

  const iframe = document.querySelector('iframe')
  if(iframe){
    iframe.remove();
  }

  /**
   * 首页文章根据时间倒序
   */

   const articleBoxes = document.querySelector('.home-article-boxes')
   if(articleBoxes){
     const articleBox = articleBoxes.querySelectorAll('.home-article-box')
     var lastDom
     var maxOrder=0
     for (let i = 0; i < articleBox.length; i++) {
      const articleBoxItem = articleBox[i];
      const articleDate = articleBoxItem.querySelector('.home-article-date')
      if(articleDate){
        const dateStr = articleDate.innerText
        const timespan = (new Date(dateStr)).getTime()
        const currentTimeSpan = (new Date()).getTime()
        const order=(currentTimeSpan-timespan)
        if(order >= maxOrder){
          maxOrder = order
          lastDom = articleBoxItem
        }
        articleBoxItem.setAttribute('style','order:' + order)
      }
     }
     if(lastDom){
      const lastDivider = lastDom.querySelector('.divider')
      if(lastDivider){
       lastDivider.remove()
      }
     }
   }

  /**
   * 文章详情页上下切换文章
   */
  const articlePrevious = document.querySelector('.article-previous')
  if (articlePrevious) {
    const currentArticle = articlePrevious.querySelector('.current-article')
    if (currentArticle) {
      articlePrevious.innerHTML =  currentArticle.nextElementSibling?currentArticle.nextElementSibling.innerHTML:''
    }
  }
  const articleNext = document.querySelector('.article-next')
  if (articleNext) {
    const currentArticle = articleNext.querySelector('.current-article')
    if (currentArticle) {
      articleNext.innerHTML = currentArticle.previousElementSibling?currentArticle.previousElementSibling.innerHTML:''
    }
  }

  // // Key map
  // var ENTER = 13;
  // var ESCAPE = 27;
  // var SPACE = 32;
  // var UP = 38;
  // var DOWN = 40;
  // var TAB = 9;

  // function closest (element, selector) {
  //   if (Element.prototype.closest) {
  //     return element.closest(selector);
  //   }
  //   do {
  //     if (Element.prototype.matches && element.matches(selector)
  //       || Element.prototype.msMatchesSelector && element.msMatchesSelector(selector)
  //       || Element.prototype.webkitMatchesSelector && element.webkitMatchesSelector(selector)) {
  //       return element;
  //     }
  //     element = element.parentElement || element.parentNode;
  //   } while (element !== null && element.nodeType === 1);
  //   return null;
  // }

  // // social share popups
  // Array.prototype.forEach.call(document.querySelectorAll('.share a'), function(anchor) {
  //   anchor.addEventListener('click', function(e) {
  //     e.preventDefault();
  //     window.open(this.href, '', 'height = 500, width = 500');
  //   });
  // });

  // // In some cases we should preserve focus after page reload
  // function saveFocus() {
  //   var activeElementId = document.activeElement.getAttribute("id");
  //   sessionStorage.setItem('returnFocusTo', '#' + activeElementId);
  // }
  // var returnFocusTo = sessionStorage.getItem('returnFocusTo');
  // if (returnFocusTo) {
  //   sessionStorage.removeItem('returnFocusTo');
  //   var returnFocusToEl = document.querySelector(returnFocusTo);
  //   returnFocusToEl && returnFocusToEl.focus && returnFocusToEl.focus();
  // }

  // // show form controls when the textarea receives focus or backbutton is used and value exists
  // var commentContainerTextarea = document.querySelector('.comment-container textarea'),
  //   commentContainerFormControls = document.querySelector('.comment-form-controls, .comment-ccs');

  // if (commentContainerTextarea) {
  //   commentContainerTextarea.addEventListener('focus', function focusCommentContainerTextarea() {
  //     commentContainerFormControls.style.display = 'block';
  //     commentContainerTextarea.removeEventListener('focus', focusCommentContainerTextarea);
  //   });

  //   if (commentContainerTextarea.value !== '') {
  //     commentContainerFormControls.style.display = 'block';
  //   }
  // }

  // // Expand Request comment form when Add to conversation is clicked
  // var showRequestCommentContainerTrigger = document.querySelector('.request-container .comment-container .comment-show-container'),
  //   requestCommentFields = document.querySelectorAll('.request-container .comment-container .comment-fields'),
  //   requestCommentSubmit = document.querySelector('.request-container .comment-container .request-submit-comment');

  // if (showRequestCommentContainerTrigger) {
  //   showRequestCommentContainerTrigger.addEventListener('click', function() {
  //     showRequestCommentContainerTrigger.style.display = 'none';
  //     Array.prototype.forEach.call(requestCommentFields, function(e) { e.style.display = 'block'; });
  //     requestCommentSubmit.style.display = 'inline-block';

  //     if (commentContainerTextarea) {
  //       commentContainerTextarea.focus();
  //     }
  //   });
  // }

  // // Mark as solved button
  // var requestMarkAsSolvedButton = document.querySelector('.request-container .mark-as-solved:not([data-disabled])'),
  //   requestMarkAsSolvedCheckbox = document.querySelector('.request-container .comment-container input[type=checkbox]'),
  //   requestCommentSubmitButton = document.querySelector('.request-container .comment-container input[type=submit]');

  // if (requestMarkAsSolvedButton) {
  //   requestMarkAsSolvedButton.addEventListener('click', function() {
  //     requestMarkAsSolvedCheckbox.setAttribute('checked', true);
  //     requestCommentSubmitButton.disabled = true;
  //     this.setAttribute('data-disabled', true);
  //     // Element.closest is not supported in IE11
  //     closest(this, 'form').submit();
  //   });
  // }

  // // Change Mark as solved text according to whether comment is filled
  // var requestCommentTextarea = document.querySelector('.request-container .comment-container textarea');

  // var usesWysiwyg = requestCommentTextarea && requestCommentTextarea.dataset.helper === "wysiwyg";

  // function isEmptyPlaintext(s) {
  //   return s.trim() === '';
  // }

  // function isEmptyHtml(xml) {
  //   var doc = new DOMParser().parseFromString(`<_>${xml}</_>`, "text/xml");
  //   var img = doc.querySelector("img");
  //   return img === null && isEmptyPlaintext(doc.children[0].textContent);
  // }

  // var isEmpty = usesWysiwyg ? isEmptyHtml : isEmptyPlaintext;

  // if (requestCommentTextarea) {
  //   requestCommentTextarea.addEventListener('input', function() {
  //     if (isEmpty(requestCommentTextarea.value)) {
  //       if (requestMarkAsSolvedButton) {
  //         requestMarkAsSolvedButton.innerText = requestMarkAsSolvedButton.getAttribute('data-solve-translation');
  //       }
  //       requestCommentSubmitButton.disabled = true;
  //     } else {
  //       if (requestMarkAsSolvedButton) {
  //         requestMarkAsSolvedButton.innerText = requestMarkAsSolvedButton.getAttribute('data-solve-and-submit-translation');
  //       }
  //       requestCommentSubmitButton.disabled = false;
  //     }
  //   });
  // }

  // // Disable submit button if textarea is empty
  // if (requestCommentTextarea && isEmpty(requestCommentTextarea.value)) {
  //   requestCommentSubmitButton.disabled = true;
  // }

  // // Submit requests filter form on status or organization change in the request list page
  // Array.prototype.forEach.call(document.querySelectorAll('#request-status-select, #request-organization-select'), function(el) {
  //   el.addEventListener('change', function(e) {
  //     e.stopPropagation();
  //     saveFocus();
  //     closest(this, 'form').submit();
  //   });
  // });

  // // Submit requests filter form on search in the request list page
  // var quickSearch = document.querySelector('#quick-search');
  // quickSearch && quickSearch.addEventListener('keyup', function(e) {
  //   if (e.keyCode === ENTER) {
  //     e.stopPropagation();
  //     saveFocus();
  //     closest(this, 'form').submit();
  //   }
  // });

  // function toggleNavigation(toggle, menu) {
  //   var isExpanded = menu.getAttribute('aria-expanded') === 'true';
  //   menu.setAttribute('aria-expanded', !isExpanded);
  //   toggle.setAttribute('aria-expanded', !isExpanded);
  // }

  // function closeNavigation(toggle, menu) {
  //   menu.setAttribute('aria-expanded', false);
  //   toggle.setAttribute('aria-expanded', false);
  //   toggle.focus();
  // }

  // var menuButton = document.querySelector('.header .menu-button-mobile');
  // var menuList = document.querySelector('#user-nav-mobile');

  // if(menuButton){
  //   menuButton.addEventListener('click', function(e) {
  //     e.stopPropagation();
  //     toggleNavigation(this, menuList);
  //   });
  
  // }
 

  // if(menuList){
  //   menuList.addEventListener('keyup', function(e) {
  //     if (e.keyCode === ESCAPE) {
  //       e.stopPropagation();
  //       closeNavigation(menuButton, this);
  //     }
  //   });
  // }

  // // Toggles expanded aria to collapsible elements
  // var collapsible = document.querySelectorAll('.collapsible-nav, .collapsible-sidebar');

  // Array.prototype.forEach.call(collapsible, function(el) {
  //   var toggle = el.querySelector('.collapsible-nav-toggle, .collapsible-sidebar-toggle');

  //   el.addEventListener('click', function(e) {
  //     toggleNavigation(toggle, this);
  //   });

  //   el.addEventListener('keyup', function(e) {
  //     if (e.keyCode === ESCAPE) {
  //       closeNavigation(toggle, this);
  //     }
  //   });
  // });

  // // Submit organization form in the request page
  // var requestOrganisationSelect = document.querySelector('#request-organization select');

  // if (requestOrganisationSelect) {
  //   requestOrganisationSelect.addEventListener('change', function() {
  //     closest(this, 'form').submit();
  //   });
  // }

  // // If multibrand search has more than 5 help centers or categories collapse the list
  // var multibrandFilterLists = document.querySelectorAll(".multibrand-filter-list");
  // Array.prototype.forEach.call(multibrandFilterLists, function(filter) {
  //   if (filter.children.length > 6) {
  //     // Display the show more button
  //     var trigger = filter.querySelector(".see-all-filters");
  //     trigger.setAttribute("aria-hidden", false);

  //     // Add event handler for click
  //     trigger.addEventListener("click", function(e) {
  //       e.stopPropagation();
  //       trigger.parentNode.removeChild(trigger);
  //       filter.classList.remove("multibrand-filter-list--collapsed")
  //     })
  //   }
  // });

  // // If there are any error notifications below an input field, focus that field
  // var notificationElm = document.querySelector(".notification-error");
  // if (
  //   notificationElm &&
  //   notificationElm.previousElementSibling &&
  //   typeof notificationElm.previousElementSibling.focus === "function"
  // ) {
  //   notificationElm.previousElementSibling.focus();
  // }

  // Dropdowns
  
  function Dropdown(toggle, menu) {
    this.toggle = toggle;
    this.menu = menu;

    this.menuPlacement = {
      top: menu.classList.contains("dropdown-menu-top"),
      end: menu.classList.contains("dropdown-menu-end")
    };

    this.toggle.addEventListener("click", this.clickHandler.bind(this));
    this.toggle.addEventListener("keydown", this.toggleKeyHandler.bind(this));
    this.menu.addEventListener("keydown", this.menuKeyHandler.bind(this));
  }

  Dropdown.prototype = {

    get isExpanded() {
      return this.menu.getAttribute("aria-expanded") === "true";
    },

    get menuItems() {
      return Array.prototype.slice.call(this.menu.querySelectorAll("[role='menuitem']"));
    },

    dismiss: function() {
      if (!this.isExpanded) return;

      this.menu.setAttribute("aria-expanded", false);
      this.menu.classList.remove("dropdown-menu-end", "dropdown-menu-top");
    },

    open: function() {
      if (this.isExpanded) return;

      this.menu.setAttribute("aria-expanded", true);
      this.handleOverflow();
    },

    handleOverflow: function() {
      var rect = this.menu.getBoundingClientRect();

      var overflow = {
        right: rect.left < 0 || rect.left + rect.width > window.innerWidth,
        bottom: rect.top < 0 || rect.top + rect.height > window.innerHeight
      };

      if (overflow.right || this.menuPlacement.end) {
        this.menu.classList.add("dropdown-menu-end");
      }

      if (overflow.bottom || this.menuPlacement.top) {
        this.menu.classList.add("dropdown-menu-top");
      }

      if (this.menu.getBoundingClientRect().top < 0) {
        this.menu.classList.remove("dropdown-menu-top")
      }
    },

    focusNextMenuItem: function(currentItem) {
      if (!this.menuItems.length) return;

      var currentIndex = this.menuItems.indexOf(currentItem);
      var nextIndex = currentIndex === this.menuItems.length - 1 || currentIndex < 0 ? 0 : currentIndex + 1;

      this.menuItems[nextIndex].focus();
    },

    focusPreviousMenuItem: function(currentItem) {
      if (!this.menuItems.length) return;

      var currentIndex = this.menuItems.indexOf(currentItem);
      var previousIndex = currentIndex <= 0 ? this.menuItems.length - 1 : currentIndex - 1;

      this.menuItems[previousIndex].focus();
    },

    clickHandler: function() {
      if (this.isExpanded) {
        this.dismiss();
      } else {
        this.open();
      }
    },

    toggleKeyHandler: function(e) {
      switch (e.keyCode) {
        case ENTER:
        case SPACE:
        case DOWN:
          e.preventDefault();
          this.open();
          this.focusNextMenuItem();
          break;
        case UP:
          e.preventDefault();
          this.open();
          this.focusPreviousMenuItem();
          break;
        case ESCAPE:
          this.dismiss();
          this.toggle.focus();
          break;
      }
    },

    menuKeyHandler: function(e) {
      var firstItem = this.menuItems[0];
      var lastItem = this.menuItems[this.menuItems.length - 1];
      var currentElement = e.target;

      switch (e.keyCode) {
        case ESCAPE:
          this.dismiss();
          this.toggle.focus();
          break;
        case DOWN:
          e.preventDefault();
          this.focusNextMenuItem(currentElement);
          break;
        case UP:
          e.preventDefault();
          this.focusPreviousMenuItem(currentElement);
          break;
        case TAB:
          if (e.shiftKey) {
            if (currentElement === firstItem) {
              this.dismiss();
            } else {
              e.preventDefault();
              this.focusPreviousMenuItem(currentElement);
            }
          } else if (currentElement === lastItem) {
            this.dismiss();
          } else {
            e.preventDefault();
            this.focusNextMenuItem(currentElement);
          }
          break;
        case ENTER:
        case SPACE:
          e.preventDefault();
          currentElement.click();
          break;
      }
    }
  }

  var dropdowns = [];
  var dropdownToggles = Array.prototype.slice.call(document.querySelectorAll(".dropdown-toggle"));

  dropdownToggles.forEach(function(toggle) {
    var menu = toggle.nextElementSibling;
    if (menu && menu.classList.contains("dropdown-menu")) {
      dropdowns.push(new Dropdown(toggle, menu));
    }
  });

  document.addEventListener("click", function(evt) {
    dropdowns.forEach(function(dropdown) {
      if (!dropdown.toggle.contains(evt.target)) {
        dropdown.dismiss();
      }
    });
  });
});
